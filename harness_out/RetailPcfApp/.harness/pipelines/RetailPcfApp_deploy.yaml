pipeline:
  name: RetailPcfApp deploy
  identifier: RetailPcfApp_deploy
  orgIdentifier: my_org
  projectIdentifier: my_project
  tags:
    platform: pcf
    tas: 'true'
  stages:
  - stage:
      name: Deploy retail-api
      identifier: Deploy_retail_api
      type: Deployment
      spec:
        deploymentType: TAS
        service:
          serviceRef: RetailPcfApp_retail_api
        environment:
          environmentRef: <+input>
          deployToAll: true
          infrastructureDefinitions:
          - identifier: input
        execution:
          steps:
          - step:
              name: Deploy
              identifier: Deploy
              type: ShellScript
              spec:
                shell: Bash
                onDelegate: true
                source:
                  type: Inline
                  spec:
                    script: 'echo TODO: implement deployment'
      failureStrategies:
      - onFailure:
          errors:
          - AllErrors
          action:
            type: StageRollback
  - stage:
      name: Deploy retail-web
      identifier: Deploy_retail_web
      type: Deployment
      spec:
        deploymentType: TAS
        service:
          serviceRef: RetailPcfApp_retail_web
        environment:
          environmentRef: <+input>
          deployToAll: true
          infrastructureDefinitions:
          - identifier: input
        execution:
          steps:
          - step:
              name: Deploy
              identifier: Deploy
              type: ShellScript
              spec:
                shell: Bash
                onDelegate: true
                source:
                  type: Inline
                  spec:
                    script: 'echo TODO: implement deployment'
      failureStrategies:
      - onFailure:
          errors:
          - AllErrors
          action:
            type: StageRollback
